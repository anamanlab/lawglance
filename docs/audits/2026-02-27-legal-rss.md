# Federal RSS Ingestion Audit (2026-02-27)

## What's Working
- `src/immcad_api/sources/source_registry_embedded.py` (and the canonical `data/sources/canada-immigration/registry.json`) registers `FC_DECISIONS` and `FCA_DECISIONS` as scheduled `case_law` sources, pointing at the Decisia RSS endpoints used by Federal Court and the Federal Court of Appeal. The entry for `FCA_DECISIONS` points at `nav.do?iframe=true`, but the ingestion/Runtime clients already expect HTML when RSS is missing.
- `src/immcad_api/sources/canada_courts.py` defines the `CourtDecisionRecord` schema, the RSS parser `parse_decisia_rss_feed`, the HTML fallback `parse_fca_decisions_html_feed`, and the validation helpers that refuse empty payloads and emit per-record validation errors. Those helpers are used both by `src/immcad_api/ingestion/jobs.py` (via `validate_court_source_payload`) and by `src/immcad_api/sources/official_case_law_client.py`, so ingestion reports include `records_total/valid/invalid` counts and runtime case-search responses only surface sanitized records.
- The ingestion driver (`scripts/run_ingestion_jobs.py` / `src/immcad_api/ingestion/jobs.py`) selects the same registry/cadence, runs each source through `SourceFetchPolicy`, and gates fetches with `is_source_ingest_allowed` from `src/immcad_api/policy/source_policy.py`. `FC_DECISIONS` and `FCA_DECISIONS` are marked `production_ingest_allowed` in `config/source_policy.yaml` (`source_policy_embedded.py`), so they can operate in hardened environments without manual overrides.
- `OfficialCaseLawClient` caches records in memory (default TTL 300 s, stale window 900 s) before converting them to `CaseSearchResult` objects that include `source_event_type`, `docket_numbers`, and `pdf_url` (`_to_result`). `CaseSearchService` bundles this client with the `CanLIIClient` fallback and exposes `/api/search/cases` through `src/immcad_api/api/routes/cases.py`, so the frontend can rely on a single proxied route (`frontend-web/app/api/search/cases/route.ts`). The chat UI (`frontend-web/components/chat/related-case-panel.tsx`) understands the `FC_DECISIONS`/`FCA_DECISIONS` source IDs and priority statuses, and the research experience honors export gating tied to `source_policy` via the same API routes.
- Ingestion checkpoints land in `.cache/immcad/ingestion-checkpoints.json` (or a path overridden by `INGESTION_CHECKPOINT_STATE_PATH` / `scripts/run_ingestion_jobs.py`), which `src/immcad_api/api/routes/source_transparency.py` and `frontend-web/app/sources/page.tsx` rehydrate when rendering the “Source Transparency” dashboard. That dashboard echoes the same `production_ingest_allowed`, `answer_citation_allowed`, and freshness status flags that `source_policy` exposes, giving operators a single surface to assess RSS health.
- `config/prompts.yaml` explicitly states that “Case-law search and lawyer-research retrieval are orchestrated by the system before this prompt,” which aligns with the fact that all federal/federal-appeal RSS ingestion and filtering happens in the backend services outlined above.

## Gaps
- The `FCA_DECISIONS` registry URL is not a true RSS feed but an HTML navigation page (`nav.do?iframe=true`). Although `parse_fca_decisions_html_feed` is already invoked as a fallback (both during ingestion and real-time fetch), there is no instrumentation or policy flag that surfaces when the HTML parser is the only path, so structural changes on the FCA page could silently break ingestion until a job fails.
- Neither ingestion jobs nor the runtime `OfficialCaseLawClient` persist decision records beyond an in-memory cache and the checkpoint metadata. If the backend restarts, the cache warms up only as queries arrive, and there is no durable index for historical searches or offline inspection—only the `.cache/immcad/ingestion-checkpoints.json` file.

## Recommendations
1. Add logging/metrics around the `parse_fca_decisions_html_feed` fallback and consider pointing to a more stable JSON/RSS endpoint if one exists; at the very least document the HTML fragility so the next deploy can re-validate the selector if the FCA markup changes.
2. Capture the fetched Federal/FCA records into a durable store (Chroma/JSONL/DB) or at least export the validated `CourtDecisionRecord` list for each ingestion run so search results can be replayed when the live fetch path is unavailable. This would also let `source_transparency` expose more than freshness seconds (e.g., record counts) and make `CaseSearchService` less sensitive to transient HTTP failures.
3. Verify that the `INGESTION_CHECKPOINT_STATE_PATH` used by ingestion scripts actually points to a shared, readable location in each deployment—currently `.cache/immcad/ingestion-checkpoints.json`—and make sure the same value is wired into the production `SourceTransparency` router so the frontend always sees the latest checkpoint state.
